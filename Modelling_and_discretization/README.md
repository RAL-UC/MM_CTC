# Modelling and Discretization

This folder contains the MATLAB scripts and precomputed data used to derive
the dynamic model of the skid-steer mobile manipulator and to obtain the
discrete-time state-space model used throughout the manuscript. The
implementation follows a coupled base–arm formulation based on
Featherstone’s spatial vector algebra and a floating-base representation.

The derivations implemented here correspond to the coupled dynamic model
described in **Section 3** and to the discrete-time linear model used in
**Section 5** for the design and analysis of the discrete PD and computed
torque controllers, including the parameter values reported in **Table 1**
and the linear model underlying the discrete root locus in **Figure 4**.

The continuous-time inverse dynamics is written in the standard form
$\tau = M(q)\ddot{q} + C(q,\dot{q}) + G(q) + F(\dot{q})$,
as in Equation (6), and the computed torque control law follows
$\tau_{\mathrm{ctc}} = M(q)\bigl[\ddot{q}_d + K_v \,\dot{\tilde{q}} + K_p \,\tilde{q}\bigr] + C(q,\dot{q}) + G(q) + F(\dot{q})$,
as in Equations (7)–(8) of the manuscript.

---

## Files

- `IDfb_MM.m`  
  Symbolic-friendly wrapper around a floating-base inverse dynamics routine
  based on Featherstone’s spatial vector formulation. It calls the
  Articulated-Body Algorithm (ABA) on the multibody model of the mobile
  manipulator and returns:
  - joint torques for the wheels and the 3-DOF arm, and  
  - the net spatial wrench acting on the floating base,  
  which is then projected onto the base yaw axis and longitudinal axis to
  obtain the efforts `tau1` (base yaw torque) and `flin1` (base longitudinal
  force). These efforts implement the base–arm interaction terms appearing
  in the coupled dynamic model of **Section 3**.

- `InvDym_MM.m`  
  Uses `IDfb_MM.m` and the underlying multibody model to compute symbolic
  expressions for:
  - `tau1`   – base yaw torque,  
  - `flin1`  – base longitudinal force,  
  - `tau3`, `tau4`, `tau5` – torques of the 3-DOF arm joints.  
  These efforts are then combined to reconstruct the standard dynamic
  model
  $M(q)\ddot{q} + C(q,\dot{q}) + G(q) = \tau$,
  which is the starting point for the inverse-dynamics control law
  introduced in **Section 4** and used in the discrete-time controller
  design in **Section 5**. The script saves its symbolic results to
  `inv_dyn.mat`.

- `MM_SymbolicLinearizationAndDiscretization.m`  
  Loads the precomputed symbolic efforts from `inv_dyn.mat`, reconstructs
  the inertia matrix $M(q)$, the Coriolis/centrifugal vector
  $C(q,\dot{q})$ and the gravity vector $G(q)$ by coefficient extraction
  with respect to the generalized accelerations, and then:
  - builds the nonlinear state-space model
    $\dot{\mathbf{x}} = \mathbf{f}(\mathbf{x},\mathbf{u})$ with  
    $\mathbf{q} = [\,\theta_b \; p_x \; q_6 \; q_7 \; q_8\,]^\top$,  
    $\mathbf{u} = [\,\tau_2 \; \tau_3 \; \tau_4 \; \tau_5 \; \tau_6 \; \tau_7 \; \tau_8\,]^\top$  
    and state vector
    $\mathbf{x} = [\,\mathbf{q}^\top \;\; \dot{\mathbf{q}}^\top\,]^\top$,
    consistent with the discrete-time formulation
    $\mathbf{f}(\mathbf{x},\mathbf{u}) = \dot{\mathbf{x}}
      = [\,\dot{\mathbf{q}}^\top \;\; \ddot{\mathbf{q}}^\top\,]^\top$
    used in Section 5 of the manuscript, [file:120]
  - computes the Jacobians $A = \partial \mathbf{f} / \partial \mathbf{x}$
    and $B = \partial \mathbf{f} / \partial \mathbf{u}$ at the chosen
    equilibrium point, [file:120]
  - defines the output matrices $C, D$, and  
  - discretizes the model using a zero-order hold (`c2d`) with sampling
    time $T_s = 10 \mathrm{ms}$, consistent with the discrete-time
    implementation discussed in **Section 5**.

- `inv_dyn.mat`  
  Precomputed symbolic inverse-dynamics data generated by `InvDym_MM.m`. It
  contains the efforts `tau1`, `flin1`, `tau3`, `tau4`, and `tau5`
  expressed in terms of the generalized coordinates, velocities, and
  accelerations. This file is provided because its generation is
  computationally expensive (in particular when run in MATLAB Online), and
  it is sufficient for reproducing the linearization, discretization, and
  controller design steps reported in the manuscript.

---

## Relation to the manuscript

- The coupled dynamic model of the mobile manipulator implemented here is
  the computational realization of the derivation presented in **Section 3**,
  including the base–arm interaction illustrated in **Figures 1–2**.
- The recovered $M(q)$, $C(q,\dot{q})$ and $G(q)$ correspond to the inverse
  dynamics equation in **Equation (6)** and are used in the definition of
  the computed torque control law in **Equations (7)–(8)**.
- The linearized, discretized model produced by
  `MM_SymbolicLinearizationAndDiscretization.m` underlies the discrete-time
  analyses in **Section 5**, including the discrete root locus study in
  **Figure 4** and the simulations summarized in **Table 2**.

---

## How to use this folder

### Recommended (fast) path

1. Ensure that the repository root is on the MATLAB path and that the
   Featherstone-based multibody model construction script used

```matlab
MM_SymbolicLinearizationAndDiscretization
```

This will:
- load `inv_dyn.mat`,  
- reconstruct $M(q)$, $C(q,\dot{q})$ and $G(q)$,  
- build the nonlinear state-space model $\dot{x} = f(x,u)$,  
- evaluate the Jacobians $A$ and $B$ at the operating point used in
  the manuscript, and  
- discretize the model with the sampling time $T_s = 10 \mathrm{ms}$,
  producing the discrete-time state-space representation used in the
  subsequent controller and PSO-tuning scripts.

### Full regeneration (optional, expensive)

If full regeneration of the inverse-dynamics expressions is required:

1. Run the inverse-dynamics script:

```matlab
InvDym_MM
```

This recomputes the symbolic efforts `tau1`, `flin1`, `tau3`, `tau4`,
and `tau5` using ABA-based floating-base inverse dynamics and overwrites
`inv_dyn.mat`. This step can be time-consuming due to heavy symbolic
computations.

2. Then run:

```matlab
MM_SymbolicLinearizationAndDiscretization
```

to rebuild $M(q)$, $C(q,\dot{q})$, $G(q)$ and the corresponding
discrete-time linear model.

For reproducing the main modelling and discretization results reported in
the manuscript, using the provided `inv_dyn.mat` and running only
`MM_SymbolicLinearizationAndDiscretization.m` is typically sufficient.